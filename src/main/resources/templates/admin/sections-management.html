<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞–º–∏</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
        .input-group {
            max-width: 300px;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */
        .alert-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .alert-toast.show {
            opacity: 1;
        }
    </style>
</head>
<body>
<div class="container mt-4">
    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞–º–∏</h2>

    <!-- –ë–ª–æ–∫ –¥–ª—è –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π -->
    <div id="alertToast" class="alert alert-toast" style="display: none;">
        <span id="alertMessage"></span>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å) -->
    <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ... -->

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–∞–∑–¥–µ–ª–æ–≤ -->
    <table class="table table-striped">
        <thead>
        <tr>
            <th>ID</th>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –≥–ª–∞–≤</th>
            <th>–®–∞–±–ª–æ–Ω</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="section : ${sections}">
            <td th:text="${section.id}"></td>
            <td th:text="${section.name}"></td>
            <td th:text="${section.chapters != null ? section.chapters.size() : 0}"></td>
            <td>
                <!-- –ï—Å–ª–∏ –µ—Å—Ç—å —à–∞–±–ª–æ–Ω - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É –∏ –∫–Ω–æ–ø–∫—É –∑–∞–º–µ–Ω—ã -->
                <div th:if="${section.templateChapter != null}">
                    <a th:href="${section.templateChapter.publicUrl}"
                       target="_blank"
                       class="btn btn-success btn-sm mb-1"
                       th:title="${section.templateChapter.name}">
                        üìé –û—Ç–∫—Ä—ã—Ç—å
                    </a>
                    <form th:action="@{/section-template/upload/{sectionId}(sectionId=${section.id})}"
                          method="post"
                          enctype="multipart/form-data"
                          style="display: inline-block;">
                        <input type="file" name="file" required
                               onchange="this.form.submit()"
                               style="display: none;"
                               th:id="'replaceFile-' + ${section.id}">
                        <button type="button"
                                class="btn btn-warning btn-sm mb-1"
                                th:onclick="'document.getElementById(\'replaceFile-' + ${section.id} + '\').click()'">
                            üîÑ –ó–∞–º–µ–Ω–∏—Ç—å
                        </button>
                    </form>
                    <form th:action="@{/section-template/delete/{sectionId}(sectionId=${section.id})}"
                          method="post"
                          style="display: inline-block;">
                        <button type="submit"
                                class="btn btn-danger btn-sm mb-1"
                                onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω?')">
                            ‚ùå –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </form>
                </div>

                <!-- –ï—Å–ª–∏ —à–∞–±–ª–æ–Ω–∞ –Ω–µ—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ -->
                <div th:unless="${section.templateChapter != null}">
                    <form th:action="@{/section-template/upload/{sectionId}(sectionId=${section.id})}"
                          method="post"
                          enctype="multipart/form-data">
                        <div class="input-group">
                            <input type="file" name="file" required
                                   class="form-control form-control-sm"
                                   accept=".doc,.docx,.pdf,.txt,.rtf">
                            <button type="submit" class="btn btn-primary btn-sm">
                                üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å
                            </button>
                        </div>
                    </form>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
    function showAlert(message, type) {
        const alertToast = document.getElementById('alertToast');
        const alertMessage = document.getElementById('alertMessage');

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ —Ç–∏–ø
        alertMessage.textContent = message;
        alertToast.className = `alert alert-${type} alert-toast`;

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        alertToast.style.display = 'block';
        setTimeout(() => {
            alertToast.classList.add('show');
        }, 100);

        // –°–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            alertToast.classList.remove('show');
            setTimeout(() => {
                alertToast.style.display = 'none';
            }, 300);
        }, 2000);
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ URL
    function getUrlParams() {
        const params = {};
        const queryString = window.location.search.substring(1);
        const pairs = queryString.split('&');

        for (const pair of pairs) {
            const [key, value] = pair.split('=');
            if (key && value) {
                // –î–µ–∫–æ–¥–∏—Ä—É–µ–º URL-encoded –∑–Ω–∞—á–µ–Ω–∏—è
                params[decodeURIComponent(key)] = decodeURIComponent(value.replace(/\+/g, ' '));
            }
        }
        return params;
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL –ø–æ—Å–ª–µ redirect
    document.addEventListener('DOMContentLoaded', function() {
        const params = getUrlParams();

        if (params.message && params.type) {
            showAlert(params.message, params.type);

            // –û—á–∏—â–∞–µ–º URL –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏—è
            const newUrl = window.location.pathname;
            window.history.replaceState({}, document.title, newUrl);
        }
    });
</script>
</body>
</html>